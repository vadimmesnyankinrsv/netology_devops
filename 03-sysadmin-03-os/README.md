# Домашнее задание к занятию "3.3. Операционные системы, лекция 1"

### 1. Какой системный вызов делает команда cd?

Сначала bash делает вызов

    stat("/tmp", {st_mode=S_IFDIR|S_ISVTX|0777, st_size=4096, ...}) = 0

Затем

    chdir("/tmp")

### 2. Используя strace выясните, где находится база данных file на основании которой она делает свои догадки.

Вероятно, это

    /usr/share/misc/magic.mgc

### 3. Основываясь на знаниях о перенаправлении потоков предложите способ обнуления открытого удаленного файла (чтобы освободить место на файловой системе).

Находим нужный файл:

    lsof -nP | grep '(deleted)'

Затем

    > /proc/<ID_ПРОЦЕССА>/fd/<ID_ФАЙЛОВОГО_ДЕСКРИПТОРА>

либо

    truncate -s 0 /proc/<ID_ПРОЦЕССА>/fd/<ID_ФАЙЛОВОГО_ДЕСКРИПТОРА>

### 4. Занимают ли зомби-процессы какие-то ресурсы в ОС (CPU, RAM, IO)?

Зомби-процессы освобождают все свои ресурсы и становятся пустой записью в таблице процессов, хранящей статус завершения для чтения родительским процессом. Однако, зомби блокируют записи в таблице процессов, размер которой ограничен для каждого пользователя и системы в целом. При достижении лимита дальнейшая работа станет невозможной.

### 5. На какие файлы вы увидели вызовы группы open за первую секунду работы утилиты?

    PID    COMM               FD ERR PATH
    794    vminfo              5   0 /var/run/utmp
    618    dbus-daemon        -1   2 /usr/local/share/dbus-1/system-services
    618    dbus-daemon        20   0 /usr/share/dbus-1/system-services
    618    dbus-daemon        -1   2 /lib/dbus-1/system-services
    618    dbus-daemon        20   0 /var/lib/snapd/dbus-1/system-services/

### 6. Какой системный вызов использует uname -a? Приведите цитату из man по этому системному вызову, где описывается альтернативное местоположение в /proc, где можно узнать версию ядра и релиз ОС.

Использует одноименный системный вызов:

    uname({sysname="Linux", nodename="vagrant", ...}) = 0

Затем установить недостающие секции man, и цитата: 

           Part of the utsname information is also accessible via /proc/sys/kernel/{ostype, hostname, osrelease, version,
       domainname}.

### 7. Чем отличается последовательность команд через ; и через && в bash? Например:...Есть ли смысл использовать в bash &&, если применить set -e?

; - разделитель команд (как в языках программирования) 
&& - добавляет условие, что следующие команды будут выполнены только при успешном выполнении предыдущих

Из справки set -e:

    -e  Exit immediately if a command exits with a non-zero status.

Использовать && вместе с set -e не имеет смысла, так как при set -e продолжение работы всего скрипта прервется при неудаче

### 8. Из каких опций состоит режим bash set -euxo pipefail и почему его хорошо было бы использовать в сценариях?

    -e  Exit immediately if a command exits with a non-zero status.
    -u  Treat unset variables as an error when substituting.
    -x  Print commands and their arguments as they are executed.
    -o pipefail     the return value of a pipeline is the status of
                           the last command to exit with a non-zero status,
                           or zero if no command exited with a non-zero status

Это повышает качество вывода и упрощает анализ. С таким набором: прервет сценарий при ненулевом коде команды, будет считать ошибкой неопределенные переменные, будет выводить команды и их аргументы по мере выполнения, кодом результата выполнения будет код ошибки последнего невыполненного скрипта.

### 9. Используя -o stat для ps, определите, какой наиболее часто встречающийся статус у процессов в системе. 

    S - спящие (ожидающие заверщения)
    R - запущенные
